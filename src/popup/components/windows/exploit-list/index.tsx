/*
 * SPDX-FileCopyrightText: 2025 cod3ddo@proton.me
 *
 * SPDX-License-Identifier: AGPL-3.0-or-later
 */

import { useState } from 'react';

import type { IExploit, IExploitResponse } from '~lib/exploits/interfaces';
import { runExploit } from '~lib/exploits/runExploit';

import { ExploitWindow } from '../exploit';
import { ExploitSelectButton } from './exploit-select-button';

interface ExploitListWindowProps {
	exploits: IExploit[];
	tabId: number;
}

export const ExploitListWindow: React.FC<ExploitListWindowProps> = ({
	exploits,
	tabId
}) => {
	const [selectedExploit, setSelectedExploit] = useState<IExploit>();
	const [exploitResult, setExploitResult] = useState<IExploitResponse>();

	const onExploitRunCallback = async (exploit: IExploit) => {
		// setExploitResult({
		// 	success: false,
		// 	message: '...'
		// });

		setExploitResult(await runExploit(exploit, tabId));
		setTimeout(() => {
			setExploitResult(undefined);
		}, 3000);
	};

	return (
		<div className="p-1.5 text-center">
			<div className="max-h-40 overflow-y-auto">
				{!selectedExploit ? (
					exploits.map((exploit) => (
						<ExploitSelectButton
							key={'exploit-selector-' + exploit.uid}
							exploit={exploit}
							result={exploitResult}
							onExploitCallback={() =>
								setSelectedExploit(exploit)
							}
							onRunCallback={async () => {
								onExploitRunCallback(exploit);
							}}
						/>
					))
				) : (
					<ExploitWindow
						exploit={selectedExploit}
						result={exploitResult}
						onBackCallback={() => {
							setSelectedExploit(undefined);
						}}
						onRunCallback={async () => {
							onExploitRunCallback(selectedExploit);
						}}
					/>
				)}
			</div>
		</div>
	);
};
